!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(self,(()=>(()=>{"use strict";var e={741:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={}},477:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(428),t)},428:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptchaLifeCycleEvent=void 0,function(e){e.Init="Init",e.SetCodeInfo="SetCodeInfo",e.GetCode="GetCode",e.GetCodeSuccess="GetCodeSuccess",e.GetCodeFail="GetCodeFail",e.GetCodeError="GetCodeError",e.CodeValueChange="CodeValueChange",e.UpdateValidateType="UpdateValidateType",e.SubmitBefore="SubmitBefore",e.Submit="Submit",e.FrontValidateFail="FrontValidateFail",e.Submitting="Submitting",e.SubmitSuccess="SubmitSuccess",e.SubmitError="SubmitError",e.SubmitFail="SubmitFail",e.SubmitFinally="SubmitFinally",e.Destroy="Destroy"}(t.CaptchaLifeCycleEvent||(t.CaptchaLifeCycleEvent={}))},621:function(e,t,n){var i,o=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Core=void 0;var a=r(n(729)),c=n(477),s=n(61),u=n(442),l=function(e){function t(t){var n=e.call(this)||this;return n.validateType=s.ValidateType.Sms,n.plugins=[],t.plugins&&t.plugins.filter((function(e){return!!e})).forEach((function(e){n.registerPlugin(e)})),n.registerPlugin(new u.SmsCode),n.setValidateType(t),n.emit(c.CaptchaLifeCycleEvent.Init),n}return o(t,e),t.prototype.registerPlugin=function(e){this.plugins.push(e),e.plugIn(this)},t.prototype.setValidateType=function(e){this.validateType=e.validateType},t.prototype.InitCodeInfo=function(e){this.emit(c.CaptchaLifeCycleEvent.SetCodeInfo,e)},t.prototype.changeCode=function(e){this.emit(c.CaptchaLifeCycleEvent.CodeValueChange,e)},t.prototype.getCode=function(){this.emit(c.CaptchaLifeCycleEvent.GetCode)},t.prototype.submit=function(){this.emit(c.CaptchaLifeCycleEvent.Submit)},t.prototype.destroy=function(){this.emit(c.CaptchaLifeCycleEvent.Destroy)},t}(a.default);t.Core=l},282:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(477),t),o(n(621),t),o(n(741),t),o(n(442),t),o(n(61),t)},63:(e,t)=>{function n(e){return"https://clue.oceanengine.com"+e}Object.defineProperty(t,"__esModule",{value:!0}),t.VALIDATE_IMG_CODE=t.SEND_SMS_CODE=t.submitUrl=void 0,t.submitUrl=n("/public/captcha/sms/verify"),t.SEND_SMS_CODE=n("/public/captcha/sms/update"),t.VALIDATE_IMG_CODE=n("/public/captcha/img/update")},442:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(640),t),o(n(63),t)},640:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{s(i.next(e))}catch(e){r(e)}}function c(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SmsCode=t.SmsCodeEvent=t.ChannelType=void 0;var r,a,c=n(63),s=n(61),u=n(477);!function(e){e[e.chengzijianzhan=0]="chengzijianzhan",e[e.czjz=1]="czjz",e[e.clue=2]="clue",e[e.open_platoform=4]="open_platoform"}(r=t.ChannelType||(t.ChannelType={})),function(e){e.SetCodeInfo="SetCodeInfo",e.GetPicCode="GetPicCode",e.CountDown="CountDown",e.UpdatePicCode="UpdatePicCode",e.UpdatePicCodeFail="UpdatePicCodeFail",e.GetCodeValidate="GetCodeValidate"}(a=t.SmsCodeEvent||(t.SmsCodeEvent={}));var l=function(){function e(){this.name="SmsCode",this.phoneNumber="",this.secretPhoneId="",this.validateImgUrl="",this.code="",this.picCode="",this.timer=0,this.intervalTime=10,this.countdown=0,this.isInit=!0,this.appId=0,this.channel=r.chengzijianzhan}return e.prototype.plugIn=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return this.coreInstance=e,this.addEventListener(),[2]}))}))},e.prototype.addEventListener=function(){var e=this,t=this.coreInstance;t.on(u.CaptchaLifeCycleEvent.SetCodeInfo,(function(n){e.phoneNumber=n.phoneNumber,e.secretPhoneId=n.secretPhoneId,e.intervalTime=n.intervalTime,e.validateImgUrl=n.validateImgUrl,e.appId=n.appId||0,e.channel=n.channel||r.chengzijianzhan,console.log(t.validateType===s.ValidateType.Sms),t.validateType===s.ValidateType.Sms&&setTimeout((function(){e.countDown()}),0)})),t.on(u.CaptchaLifeCycleEvent.Init,(function(){e.initCode()})),t.on(u.CaptchaLifeCycleEvent.GetCode,(function(){e.getCode()})),t.on(a.GetPicCode,(function(){e.getPicCode()})),t.on(u.CaptchaLifeCycleEvent.CodeValueChange,(function(t){"string"==typeof t.code&&(e.code=t.code),"string"==typeof t.picCode&&(e.picCode=t.picCode)})),t.on(u.CaptchaLifeCycleEvent.Submit,(function(){e.submit()})),t.on(u.CaptchaLifeCycleEvent.Destroy,(function(){clearInterval(e.timer)}))},e.prototype.plugOff=function(){},e.prototype.countDown=function(){var e=this,t=this.coreInstance;this.countdown=this.intervalTime,t.emit(a.CountDown,this.countdown),clearInterval(this.timer),this.timer=setInterval((function(){e.countdown=e.countdown-1,e.countdown<0&&(clearInterval(e.timer),e.timer=0),t.emit(a.CountDown,e.countdown)}),1e3)},e.prototype.initCode=function(){this.coreInstance.validateType,s.ValidateType.PicBeforeSms},e.prototype.getPicCode=function(){var e=this,t=e.phoneNumber,n=e.secretPhoneId,i=e.coreInstance,o=this.validateImgUrl;i.API.basePost(c.VALIDATE_IMG_CODE,{phone_number:t,secret_phone_id:n,app_id:this.appId}).then((function(e){i.emit(a.UpdatePicCode,e.pic_url||o)})).catch((function(e){i.emit(a.UpdatePicCodeFail,e.status+": "+e.message)}))},e.prototype.getCode=function(){var t=this;if(!(this.timer>0)){var n=this,i=n.phoneNumber,o=n.secretPhoneId,r=n.coreInstance,l=r.validateType===s.ValidateType.PicBeforeSms,p=this.picCode,f=e.validatePicCode(l,p);r.emit(a.GetCodeValidate,f),1===f.state&&r.API.basePost(c.SEND_SMS_CODE,{pic_code:p,phone_number:i,secret_phone_id:o,app_id:this.appId,channel:this.channel}).then((function(e){t.handleValidateResult(e)})).catch((function(e){r.emit(u.CaptchaLifeCycleEvent.GetCodeError,e)}))}},e.prototype.submit=function(){var t=this,n=this,i=n.phoneNumber,o=n.secretPhoneId,r=n.coreInstance,a=this.code,l=r.validateType===s.ValidateType.PicBeforeSms,p=this.picCode,f=e.validatePicCode(l,p),d=e.validateSmsCode(a);if(1===f.state)if(1===d.state){var h=/^\d{11}$/.test(i)?"":o;r.emit(u.CaptchaLifeCycleEvent.SubmitBefore),r.API.post(c.submitUrl,{phone_number:i,secret_phone_id:h,sms_code:a,app_id:this.appId}).then((function(e){200===e.status?(clearInterval(t.timer),r.emit(u.CaptchaLifeCycleEvent.SubmitSuccess,e)):400===e.status?r.emit(u.CaptchaLifeCycleEvent.SubmitError,e):500===e.status&&r.emit(u.CaptchaLifeCycleEvent.SubmitFail,e)})).then((function(){r.emit(u.CaptchaLifeCycleEvent.SubmitFinally)})).catch((function(){r.emit(u.CaptchaLifeCycleEvent.SubmitFinally)}))}else r.emit(u.CaptchaLifeCycleEvent.FrontValidateFail,d);else r.emit(u.CaptchaLifeCycleEvent.FrontValidateFail,f)},e.prototype.handleValidateResult=function(e){var t=this.validateImgUrl,n=this.coreInstance;6===e.status?(this.countDown(),n.emit(u.CaptchaLifeCycleEvent.GetCodeSuccess)):(""!==e.pic_url&&(n.setValidateType({validateType:s.ValidateType.PicBeforeSms}),n.emit(a.UpdatePicCode,e.pic_url||t),n.emit(u.CaptchaLifeCycleEvent.UpdateValidateType,s.ValidateType.PicBeforeSms)),n.emit(u.CaptchaLifeCycleEvent.GetCodeFail,e))},e.validatePicCode=function(e,t){return e&&!t?{state:7,reason:"图片验证码不能为空"}:{state:1,reason:""}},e.validateSmsCode=function(e){return e?{state:1,reason:""}:{state:8,reason:"短信验证码不能为空"}},e}();t.SmsCode=l},61:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidateType=void 0,function(e){e.Sms="sms",e.PicBeforeSms="pic_before_sms",e.Selection="selection"}(t.ValidateType||(t.ValidateType={}))},729:e=>{var t=Object.prototype.hasOwnProperty,n="~";function i(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,i,r,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var c=new o(i,r||e,a),s=n?n+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],c]:e._events[s].push(c):(e._events[s]=c,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),c.prototype.eventNames=function(){var e,i,o=[];if(0===this._eventsCount)return o;for(i in e=this._events)t.call(e,i)&&o.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},c.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var o=0,r=i.length,a=new Array(r);o<r;o++)a[o]=i[o].fn;return a},c.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},c.prototype.emit=function(e,t,i,o,r,a){var c=n?n+e:e;if(!this._events[c])return!1;var s,u,l=this._events[c],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,o),!0;case 5:return l.fn.call(l.context,t,i,o,r),!0;case 6:return l.fn.call(l.context,t,i,o,r,a),!0}for(u=1,s=new Array(p-1);u<p;u++)s[u-1]=arguments[u];l.fn.apply(l.context,s)}else{var f,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),p){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,o);break;default:if(!s)for(f=1,s=new Array(p-1);f<p;f++)s[f-1]=arguments[f];l[u].fn.apply(l[u].context,s)}}return!0},c.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,i,o){var r=n?n+e:e;if(!this._events[r])return this;if(!t)return a(this,r),this;var c=this._events[r];if(c.fn)c.fn!==t||o&&!c.once||i&&c.context!==i||a(this,r);else{for(var s=0,u=[],l=c.length;s<l;s++)(c[s].fn!==t||o&&!c[s].once||i&&c[s].context!==i)&&u.push(c[s]);u.length?this._events[r]=1===u.length?u[0]:u:a(this,r)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,e.exports=c}},t={};var n=function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}(282);return n})()));
//# sourceMappingURL=index.js.map